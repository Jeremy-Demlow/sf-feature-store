<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="A comprehensive guide to setting up and using the Snowflake Feature Store for ML workflows.">

<title>End-to-End Feature Store Example – sf-feature-store</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ae44de7e3b26b230a7801128389852ee.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="End-to-End Feature Store Example – sf-feature-store">
<meta property="og:description" content="A comprehensive guide to setting up and using the Snowflake Feature Store for ML workflows.">
<meta property="og:site_name" content="sf-feature-store">
<meta name="twitter:title" content="End-to-End Feature Store Example – sf-feature-store">
<meta name="twitter:description" content="A comprehensive guide to setting up and using the Snowflake Feature Store for ML workflows.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">sf-feature-store</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./simple_example.html">End-to-End Feature Store Example</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snowflake Feature Store</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./expections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Expections</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feature_view.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Views</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Expections</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./connection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Connection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Transforms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manager.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manager (Features)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example Module</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple_example.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">End-to-End Feature Store Example</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kaggle_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kaggle Competition Example</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Load Kaggle Competition Data</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link active" data-scroll-target="#data-generation">Data Generation</a></li>
  <li><a href="#step-1-setting-up-the-feature-store" id="toc-step-1-setting-up-the-feature-store" class="nav-link" data-scroll-target="#step-1-setting-up-the-feature-store">Step 1: Setting Up the Feature Store</a>
  <ul class="collapse">
  <li><a href="#required-permissions" id="toc-required-permissions" class="nav-link" data-scroll-target="#required-permissions">Required Permissions</a></li>
  <li><a href="#why-permanent-vs-temporary" id="toc-why-permanent-vs-temporary" class="nav-link" data-scroll-target="#why-permanent-vs-temporary">Why Permanent vs Temporary?</a></li>
  </ul></li>
  <li><a href="#step-2-data-generation-and-loading" id="toc-step-2-data-generation-and-loading" class="nav-link" data-scroll-target="#step-2-data-generation-and-loading">Step 2: Data Generation and Loading</a>
  <ul class="collapse">
  <li><a href="#why-this-structure" id="toc-why-this-structure" class="nav-link" data-scroll-target="#why-this-structure">Why This Structure?</a></li>
  <li><a href="#why-ltv-prediction" id="toc-why-ltv-prediction" class="nav-link" data-scroll-target="#why-ltv-prediction">Why LTV Prediction?</a></li>
  <li><a href="#data-structure" id="toc-data-structure" class="nav-link" data-scroll-target="#data-structure">Data Structure</a></li>
  </ul></li>
  <li><a href="#step-3-entity-creation" id="toc-step-3-entity-creation" class="nav-link" data-scroll-target="#step-3-entity-creation">Step 3: Entity Creation</a>
  <ul class="collapse">
  <li><a href="#why-entities-matter" id="toc-why-entities-matter" class="nav-link" data-scroll-target="#why-entities-matter">Why Entities Matter</a></li>
  <li><a href="#entity-best-practices" id="toc-entity-best-practices" class="nav-link" data-scroll-target="#entity-best-practices">Entity Best Practices</a></li>
  <li><a href="#entity-design-for-ltv" id="toc-entity-design-for-ltv" class="nav-link" data-scroll-target="#entity-design-for-ltv">Entity Design for LTV</a></li>
  <li><a href="#key-points-about-this-implementation" id="toc-key-points-about-this-implementation" class="nav-link" data-scroll-target="#key-points-about-this-implementation">Key Points About This Implementation</a></li>
  </ul></li>
  <li><a href="#step-4-feature-configuration" id="toc-step-4-feature-configuration" class="nav-link" data-scroll-target="#step-4-feature-configuration">Step 4: Feature Configuration</a>
  <ul class="collapse">
  <li><a href="#feature-configuration-concepts" id="toc-feature-configuration-concepts" class="nav-link" data-scroll-target="#feature-configuration-concepts">Feature Configuration Concepts</a></li>
  <li><a href="#why-configuration-matters" id="toc-why-configuration-matters" class="nav-link" data-scroll-target="#why-configuration-matters">Why Configuration Matters</a></li>
  <li><a href="#ltv-feature-configuration" id="toc-ltv-feature-configuration" class="nav-link" data-scroll-target="#ltv-feature-configuration">LTV Feature Configuration</a></li>
  </ul></li>
  <li><a href="#step-5-feature-transformations" id="toc-step-5-feature-transformations" class="nav-link" data-scroll-target="#step-5-feature-transformations">Step 5: Feature Transformations</a>
  <ul class="collapse">
  <li><a href="#why-transformations-matter" id="toc-why-transformations-matter" class="nav-link" data-scroll-target="#why-transformations-matter">Why Transformations Matter</a></li>
  <li><a href="#types-of-transformations" id="toc-types-of-transformations" class="nav-link" data-scroll-target="#types-of-transformations">Types of Transformations</a></li>
  <li><a href="#ltv-specific-transformations" id="toc-ltv-specific-transformations" class="nav-link" data-scroll-target="#ltv-specific-transformations">LTV-Specific Transformations</a></li>
  <li><a href="#best-practices-for-transformations" id="toc-best-practices-for-transformations" class="nav-link" data-scroll-target="#best-practices-for-transformations">Best Practices for Transformations</a></li>
  <li><a href="#example-usage" id="toc-example-usage" class="nav-link" data-scroll-target="#example-usage">Example Usage</a></li>
  </ul></li>
  <li><a href="#step-6-feature-view-creation" id="toc-step-6-feature-view-creation" class="nav-link" data-scroll-target="#step-6-feature-view-creation">Step 6: Feature View Creation</a>
  <ul class="collapse">
  <li><a href="#what-is-a-feature-view" id="toc-what-is-a-feature-view" class="nav-link" data-scroll-target="#what-is-a-feature-view">What is a Feature View?</a></li>
  <li><a href="#why-feature-views-matter" id="toc-why-feature-views-matter" class="nav-link" data-scroll-target="#why-feature-views-matter">Why Feature Views Matter</a></li>
  <li><a href="#ltv-feature-view-design" id="toc-ltv-feature-view-design" class="nav-link" data-scroll-target="#ltv-feature-view-design">LTV Feature View Design</a></li>
  <li><a href="#best-practices-for-feature-views" id="toc-best-practices-for-feature-views" class="nav-link" data-scroll-target="#best-practices-for-feature-views">Best Practices for Feature Views</a></li>
  </ul></li>
  <li><a href="#step-7-feature-monitoring" id="toc-step-7-feature-monitoring" class="nav-link" data-scroll-target="#step-7-feature-monitoring">Step 7: Feature Monitoring</a>
  <ul class="collapse">
  <li><a href="#why-monitor-features" id="toc-why-monitor-features" class="nav-link" data-scroll-target="#why-monitor-features">Why Monitor Features?</a></li>
  <li><a href="#types-of-monitoring" id="toc-types-of-monitoring" class="nav-link" data-scroll-target="#types-of-monitoring">Types of Monitoring</a></li>
  <li><a href="#ltv-specific-monitoring" id="toc-ltv-specific-monitoring" class="nav-link" data-scroll-target="#ltv-specific-monitoring">LTV-Specific Monitoring</a></li>
  <li><a href="#example-usage-1" id="toc-example-usage-1" class="nav-link" data-scroll-target="#example-usage-1">Example Usage</a></li>
  </ul></li>
  <li><a href="#step-8-training-data-generation" id="toc-step-8-training-data-generation" class="nav-link" data-scroll-target="#step-8-training-data-generation">Step 8: Training Data Generation</a>
  <ul class="collapse">
  <li><a href="#why-training-data-generation-matters" id="toc-why-training-data-generation-matters" class="nav-link" data-scroll-target="#why-training-data-generation-matters">Why Training Data Generation Matters</a></li>
  <li><a href="#ltv-training-data-requirements" id="toc-ltv-training-data-requirements" class="nav-link" data-scroll-target="#ltv-training-data-requirements">LTV Training Data Requirements</a></li>
  <li><a href="#best-practices-for-training-data" id="toc-best-practices-for-training-data" class="nav-link" data-scroll-target="#best-practices-for-training-data">Best Practices for Training Data</a></li>
  </ul></li>
  <li><a href="#conclusion-and-next-steps" id="toc-conclusion-and-next-steps" class="nav-link" data-scroll-target="#conclusion-and-next-steps">Conclusion and Next Steps</a>
  <ul class="collapse">
  <li><a href="#what-weve-built" id="toc-what-weve-built" class="nav-link" data-scroll-target="#what-weve-built">What We’ve Built</a></li>
  <li><a href="#potential-enhancements" id="toc-potential-enhancements" class="nav-link" data-scroll-target="#potential-enhancements">Potential Enhancements</a></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a></li>
  <li><a href="#using-this-template" id="toc-using-this-template" class="nav-link" data-scroll-target="#using-this-template">Using This Template</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Jeremy-Demlow/sf-feature-store/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="simple_example.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">End-to-End Feature Store Example</h1>
</div>

<div>
  <div class="description">
    A comprehensive guide to setting up and using the Snowflake Feature Store for ML workflows.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="data-generation" class="level2">
<h2 class="anchored" data-anchor-id="data-generation">Data Generation</h2>
<p>First, we’ll create some example customer data:</p>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> snowflake.snowpark.functions <span class="im">as</span> F</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.connection <span class="im">import</span> get_connection</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.manager <span class="im">import</span> FeatureStoreManager</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.config <span class="im">import</span> (</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    FeatureViewConfig, FeatureConfig, RefreshConfig, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    FeatureValidationConfig</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.transforms <span class="im">import</span> (</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    Transform, TransformConfig, moving_agg, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    fill_na, date_diff, CustomTransform</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.examples <span class="im">import</span> (</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    get_example_data, create_feature_configs</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.logging <span class="im">import</span> logger</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-1-setting-up-the-feature-store" class="level2">
<h2 class="anchored" data-anchor-id="step-1-setting-up-the-feature-store">Step 1: Setting Up the Feature Store</h2>
<p>First, we’ll create a permanent feature store in Snowflake. This differs from our previous examples which used temporary schemas.</p>
<section id="required-permissions" class="level3">
<h3 class="anchored" data-anchor-id="required-permissions">Required Permissions</h3>
<p>To create a permanent feature store, you need: - <code>CREATE DATABASE</code> if creating a new database - <code>CREATE SCHEMA</code> in the target database - <code>USAGE</code> on the warehouse - <code>CREATE TABLE</code> in the target schema</p>
</section>
<section id="why-permanent-vs-temporary" class="level3">
<h3 class="anchored" data-anchor-id="why-permanent-vs-temporary">Why Permanent vs Temporary?</h3>
<p>Permanent feature stores offer several advantages: 1. Persistence across sessions 2. Accessibility through Snowsight UI 3. Ability to share with other users/roles 4. Integration with other Snowflake tools</p>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify all connection parameters directly</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>database <span class="op">=</span> <span class="st">"DATASCIENCE"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> <span class="st">"FEATURE_STORE_DEMO"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>warehouse <span class="op">=</span> <span class="st">"DS_WH_XS"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>role <span class="op">=</span> <span class="st">"DATA_SCIENTIST"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get connection with all custom parameters</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> get_connection(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    database<span class="op">=</span>database, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>schema, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    warehouse<span class="op">=</span>warehouse,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    role<span class="op">=</span>role</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can use the connection with the proper context</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Connected to </span><span class="sc">{</span>database<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>schema<span class="sc">}</span><span class="ss"> as </span><span class="sc">{</span>role<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 18:57:01,857 - snowflake_feature_store - INFO - Using active Snowflake session
2025-02-26 18:57:01,858 - snowflake_feature_store - INFO - Initialized connection to "DATASCIENCE"."FEATURE_STORE_DEMO"
2025-02-26 18:57:04,045 - snowflake_feature_store - INFO - Using role: "DATA_SCIENTIST", warehouse: "DS_WH_XS", database: DATASCIENCE, schema: FEATURE_STORE_DEMO
2025-02-26 18:57:04,047 - snowflake_feature_store - INFO - Connected to DATASCIENCE.FEATURE_STORE_DEMO as DATA_SCIENTIST</code></pre>
</div>
</div>
</section>
</section>
<section id="step-2-data-generation-and-loading" class="level2">
<h2 class="anchored" data-anchor-id="step-2-data-generation-and-loading">Step 2: Data Generation and Loading</h2>
<p>In this section, we’ll create example customer data. In a real scenario, you’d load your own data, but this example shows: 1. Proper data typing for Snowflake 2. Handling temporal data correctly 3. Setting up data quality checks 4. Creating realistic patterns in the data</p>
<section id="why-this-structure" class="level3">
<h3 class="anchored" data-anchor-id="why-this-structure">Why This Structure?</h3>
<p>This structure demonstrates common ML feature engineering challenges: 1. <strong>Time-based Features</strong>: Rolling averages, time windows 2. <strong>Missing Data</strong>: Handling sparse observations 3. <strong>Multiple Metrics</strong>: Combining different data types 4. <strong>Entity Resolution</strong>: Linking data to customers</p>
</section>
<section id="why-ltv-prediction" class="level3">
<h3 class="anchored" data-anchor-id="why-ltv-prediction">Why LTV Prediction?</h3>
<p>LTV prediction is a common ML use case that demonstrates key feature store benefits: 1. <strong>Time-based Features</strong>: Customer spending patterns over time 2. <strong>Multiple Data Sources</strong>: Combining transactions, web analytics, and customer data 3. <strong>Feature Freshness</strong>: Regular updates as new transactions occur 4. <strong>Point-in-Time Correctness</strong>: Avoiding data leakage in training</p>
</section>
<section id="data-structure" class="level3">
<h3 class="anchored" data-anchor-id="data-structure">Data Structure</h3>
<p>Our LTV example includes: - <code>LIFE_TIME_VALUE</code>: Current customer value (target) - <code>SESSION_LENGTH</code>: Customer engagement metric - <code>TRANSACTIONS</code>: Number of transactions - <code>TIME_ON_APP/WEBSITE</code>: Engagement channels</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get start date</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>num_customers <span class="op">=</span>  <span class="dv">100</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with patterns</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> get_example_data(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    conn.session,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    schema,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    num_customers,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data profile</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Data Profile:"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    null_count <span class="op">=</span> df.<span class="bu">filter</span>(F.col(col).is_null()).count()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    null_pct <span class="op">=</span> null_count <span class="op">/</span> df.count() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>null_pct<span class="sc">:.1f}</span><span class="ss">% null"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 18:57:20,976 - snowflake_feature_store - INFO - Generated 2400 rows of demo data in "DATASCIENCE".FEATURE_STORE_DEMO.CUSTOMER_ACTIVITY
2025-02-26 18:57:20,979 - snowflake_feature_store - INFO - 
Sample Data:
---------------------------------------------------------------------------------------------------------------------------------
|"CUSTOMER_ID"  |"DATE"      |"LIFE_TIME_VALUE"  |"SESSION_LENGTH"   |"TIME_ON_APP"       |"TIME_ON_WEBSITE"   |"TRANSACTIONS"  |
---------------------------------------------------------------------------------------------------------------------------------
|C26            |2025-01-27  |564.6091706355498  |7.616530664264483  |12.142466259190991  |10.138495747448552  |5               |
|C85            |2025-02-25  |59.41299820191271  |4.727356127459224  |5.495725181799517   |3.859344227079125   |1               |
|C72            |2025-02-25  |646.3111447043822  |8.908367451703572  |9.728204471331994   |13.191869376320893  |6               |
|C60            |2025-02-25  |447.0367329096978  |8.704973243200099  |10.936684313415565  |11.222118890927462  |4               |
|C48            |2025-02-25  |294.3029664683961  |NULL               |5.2542111627227275  |7.048625379945507   |2               |
---------------------------------------------------------------------------------------------------------------------------------

2025-02-26 18:57:22,023 - snowflake_feature_store - INFO - 
Schema:
2025-02-26 18:57:22,252 - snowflake_feature_store - INFO - CUSTOMER_ID: StringType()
2025-02-26 18:57:22,253 - snowflake_feature_store - INFO - DATE: DateType()
2025-02-26 18:57:22,254 - snowflake_feature_store - INFO - LIFE_TIME_VALUE: DoubleType()
2025-02-26 18:57:22,255 - snowflake_feature_store - INFO - SESSION_LENGTH: DoubleType()
2025-02-26 18:57:22,255 - snowflake_feature_store - INFO - TIME_ON_APP: DoubleType()
2025-02-26 18:57:22,256 - snowflake_feature_store - INFO - TIME_ON_WEBSITE: DoubleType()
2025-02-26 18:57:22,257 - snowflake_feature_store - INFO - TRANSACTIONS: LongType()
2025-02-26 18:57:22,257 - snowflake_feature_store - INFO - 
Data Profile:
2025-02-26 18:57:23,040 - snowflake_feature_store - INFO - CUSTOMER_ID: 0.0% null
2025-02-26 18:57:23,442 - snowflake_feature_store - INFO - DATE: 0.0% null
2025-02-26 18:57:23,879 - snowflake_feature_store - INFO - LIFE_TIME_VALUE: 0.0% null
2025-02-26 18:57:24,264 - snowflake_feature_store - INFO - SESSION_LENGTH: 20.5% null
2025-02-26 18:57:24,797 - snowflake_feature_store - INFO - TIME_ON_APP: 0.0% null
2025-02-26 18:57:25,175 - snowflake_feature_store - INFO - TIME_ON_WEBSITE: 0.0% null
2025-02-26 18:57:25,571 - snowflake_feature_store - INFO - TRANSACTIONS: 0.0% null</code></pre>
</div>
</div>
</section>
</section>
<section id="step-3-entity-creation" class="level2">
<h2 class="anchored" data-anchor-id="step-3-entity-creation">Step 3: Entity Creation</h2>
<p>Entities are the foundation of your feature store. They represent the objects you’re collecting features about (e.g., customers, products, transactions).</p>
<section id="why-entities-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-entities-matter">Why Entities Matter</h3>
<p>Proper entity design is crucial because: 1. Entities determine how features can be joined 2. Entities define the granularity of your features 3. Entities enable point-in-time correct feature retrieval 4. Entities help organize and discover features</p>
</section>
<section id="entity-best-practices" class="level3">
<h3 class="anchored" data-anchor-id="entity-best-practices">Entity Best Practices</h3>
<ol type="1">
<li><strong>Unique Keys</strong>: Choose stable, unique identifiers</li>
<li><strong>Granularity</strong>: Pick the right level (e.g., customer vs.&nbsp;session)</li>
<li><strong>Documentation</strong>: Clearly describe what the entity represents</li>
<li><strong>Consistency</strong>: Use the same keys across feature views</li>
</ol>
</section>
<section id="entity-design-for-ltv" class="level3">
<h3 class="anchored" data-anchor-id="entity-design-for-ltv">Entity Design for LTV</h3>
<p>For LTV prediction, we need a customer entity that: 1. Has a stable identifier 2. Links to all customer interactions 3. Supports time-based feature aggregation</p>
<p>Key considerations for our customer entity: 1. <strong>Identifier</strong>: Use <code>CUSTOMER_ID</code> as stable key 2. <strong>Temporal Aspect</strong>: Track customer since first transaction 3. <strong>Granularity</strong>: Customer-level for LTV prediction 4. <strong>Documentation</strong>: Clear description for feature discovery</p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create detailed documentation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>description <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">Customer Entity for LTV Prediction</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">This entity represents individual customers and their behavior over time.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">It serves as the primary entity for customer lifetime value prediction.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">Key Information:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">- Primary Key: CUSTOMER_ID (stable identifier)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">- Temporal Key: DATE (for point-in-time correct features)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">- Granularity: One record per customer per day</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">Usage:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">1. Base entity for customer-level features</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">2. Join key for transaction and session data</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">3. Temporal alignment for time-based features</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">Best Practices:</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">- Always join using CUSTOMER_ID</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">- Use DATE for point-in-time correctness</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="st">- Aggregate features to customer-day level</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">Example:</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">```sql</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT CUSTOMER_ID, DATE, COUNT(*) as daily_transactions</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY CUSTOMER_ID, DATE</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.strip()</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>metrics_dir <span class="op">=</span> Path(tempfile.mkdtemp()) <span class="op">/</span> <span class="st">"feature_store_metrics"</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>manager <span class="op">=</span> FeatureStoreManager(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">=</span>conn,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    metrics_path<span class="op">=</span>metrics_dir,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    overwrite<span class="op">=</span><span class="va">True</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create entity</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>manager.add_entity(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"CUSTOMER"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    join_keys<span class="op">=</span>[<span class="st">"CUSTOMER_ID"</span>],</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span>description,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Created CUSTOMER entity for LTV prediction"</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify entity creation</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>entity <span class="op">=</span> manager.feature_store.get_entity(<span class="st">"CUSTOMER"</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Entity Details:"</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Name: </span><span class="sc">{</span>entity<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Join Keys: </span><span class="sc">{</span>entity<span class="sc">.</span>join_keys<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 18:57:35,615 - snowflake_feature_store - INFO - FeatureStoreManager initialized
2025-02-26 18:57:37,238 - snowflake_feature_store - INFO - Created entity: CUSTOMER with keys: ['CUSTOMER_ID']
2025-02-26 18:57:37,240 - snowflake_feature_store - INFO - Created CUSTOMER entity for LTV prediction
2025-02-26 18:57:38,054 - snowflake_feature_store - INFO - 
Entity Details:
2025-02-26 18:57:38,055 - snowflake_feature_store - INFO - Name: CUSTOMER
2025-02-26 18:57:38,056 - snowflake_feature_store - INFO - Join Keys: ['CUSTOMER_ID']</code></pre>
</div>
</div>
</section>
<section id="key-points-about-this-implementation" class="level3">
<h3 class="anchored" data-anchor-id="key-points-about-this-implementation">Key Points About This Implementation</h3>
<ol type="1">
<li><strong>Documentation</strong>
<ul>
<li>Clear description of entity purpose</li>
<li>Usage examples included</li>
<li>Best practices documented</li>
<li>SQL example provided</li>
</ul></li>
<li><strong>Validation</strong>
<ul>
<li>Entity creation is verified</li>
<li>Join keys are explicitly defined</li>
<li>Logging provides creation confirmation</li>
<li>Error handling is included</li>
</ul></li>
<li><strong>LTV Specific</strong>
<ul>
<li>Designed for customer-level predictions</li>
<li>Supports temporal feature creation</li>
<li>Enables point-in-time correct joins</li>
<li>Facilitates customer behavior tracking</li>
</ul></li>
</ol>
</section>
</section>
<section id="step-4-feature-configuration" class="level2">
<h2 class="anchored" data-anchor-id="step-4-feature-configuration">Step 4: Feature Configuration</h2>
<p>Feature configuration is where we define what features we want to create and how they should behave.</p>
<section id="feature-configuration-concepts" class="level3">
<h3 class="anchored" data-anchor-id="feature-configuration-concepts">Feature Configuration Concepts</h3>
<p>A feature configuration defines: 1. <strong>Validation Rules</strong>: Data quality checks and thresholds 2. <strong>Dependencies</strong>: What other features this feature needs 3. <strong>Metadata</strong>: Description, tags, and ownership 4. <strong>Refresh Settings</strong>: How often to update the feature</p>
</section>
<section id="why-configuration-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-configuration-matters">Why Configuration Matters</h3>
<p>Good feature configuration ensures: 1. Data quality is maintained 2. Features are well-documented 3. Dependencies are tracked 4. Feature freshness is appropriate</p>
</section>
<section id="ltv-feature-configuration" class="level3">
<h3 class="anchored" data-anchor-id="ltv-feature-configuration">LTV Feature Configuration</h3>
<p>For LTV prediction, we need several types of features: 1. <strong>Behavioral Features</strong> - Session metrics - Engagement patterns - Transaction history</p>
<ol start="2" type="1">
<li><strong>Temporal Features</strong>
<ul>
<li>Time since first purchase</li>
<li>Weekly/monthly patterns</li>
<li>Rolling aggregations</li>
</ul></li>
<li><strong>Derived Features</strong>
<ul>
<li>Average transaction value</li>
<li>Engagement ratios</li>
<li>Time-based metrics</li>
</ul></li>
</ol>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base features (from source data)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>feature_configs <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LIFE_TIME_VALUE"</span>: FeatureConfig(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"LIFE_TIME_VALUE"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Current customer lifetime value"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            null_threshold<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SESSION_LENGTH"</span>: FeatureConfig(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"SESSION_LENGTH"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Session length in minutes"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            null_threshold<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTIONS"</span>: FeatureConfig(</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"TRANSACTIONS"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Number of transactions"</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            null_threshold<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window features (match moving_agg output names)</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> window <span class="kw">in</span> [<span class="dv">7</span>, <span class="dv">30</span>]:</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> metric <span class="kw">in</span> [<span class="st">'TRANSACTIONS'</span>, <span class="st">'LIFE_TIME_VALUE'</span>]:</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> agg <span class="kw">in</span> [<span class="st">'SUM'</span>, <span class="st">'AVG'</span>]:</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            feature_name <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>agg<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>metric<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>            feature_configs[feature_name] <span class="op">=</span> FeatureConfig(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>feature_name,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                description<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>agg<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span>metric<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss"> over </span><span class="sc">{</span>window<span class="sc">}</span><span class="ss"> days"</span>,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                    null_threshold<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                    range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                    min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                dependencies<span class="op">=</span>[metric]</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Derived features</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>feature_configs.update({</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ENGAGEMENT_SCORE"</span>: FeatureConfig(</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"ENGAGEMENT_SCORE"</span>,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Combined engagement metric"</span>,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>            null_threshold<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>            range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>            min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        dependencies<span class="op">=</span>[<span class="st">"SESSION_LENGTH"</span>, <span class="st">"TIME_ON_APP"</span>, <span class="st">"TIME_ON_WEBSITE"</span>]</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AVG_TRANSACTION_VALUE"</span>: FeatureConfig(</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"AVG_TRANSACTION_VALUE"</span>,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">"Average value per transaction"</span>,</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        validation<span class="op">=</span>FeatureValidationConfig(</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            null_threshold<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            range_check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            min_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        dependencies<span class="op">=</span>[<span class="st">"LIFE_TIME_VALUE"</span>, <span class="st">"TRANSACTIONS"</span>]</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>feature_configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'LIFE_TIME_VALUE': FeatureConfig(name='LIFE_TIME_VALUE', description='Current customer lifetime value', validation=FeatureValidationConfig(null_check=True, null_threshold=0.0, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=[]),
 'SESSION_LENGTH': FeatureConfig(name='SESSION_LENGTH', description='Session length in minutes', validation=FeatureValidationConfig(null_check=True, null_threshold=0.2, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=[]),
 'TRANSACTIONS': FeatureConfig(name='TRANSACTIONS', description='Number of transactions', validation=FeatureValidationConfig(null_check=True, null_threshold=0.0, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=[]),
 'SUM_TRANSACTIONS_7': FeatureConfig(name='SUM_TRANSACTIONS_7', description='sum of transactions over 7 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['TRANSACTIONS']),
 'AVG_TRANSACTIONS_7': FeatureConfig(name='AVG_TRANSACTIONS_7', description='avg of transactions over 7 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['TRANSACTIONS']),
 'SUM_LIFE_TIME_VALUE_7': FeatureConfig(name='SUM_LIFE_TIME_VALUE_7', description='sum of life_time_value over 7 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['LIFE_TIME_VALUE']),
 'AVG_LIFE_TIME_VALUE_7': FeatureConfig(name='AVG_LIFE_TIME_VALUE_7', description='avg of life_time_value over 7 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['LIFE_TIME_VALUE']),
 'SUM_TRANSACTIONS_30': FeatureConfig(name='SUM_TRANSACTIONS_30', description='sum of transactions over 30 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['TRANSACTIONS']),
 'AVG_TRANSACTIONS_30': FeatureConfig(name='AVG_TRANSACTIONS_30', description='avg of transactions over 30 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['TRANSACTIONS']),
 'SUM_LIFE_TIME_VALUE_30': FeatureConfig(name='SUM_LIFE_TIME_VALUE_30', description='sum of life_time_value over 30 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['LIFE_TIME_VALUE']),
 'AVG_LIFE_TIME_VALUE_30': FeatureConfig(name='AVG_LIFE_TIME_VALUE_30', description='avg of life_time_value over 30 days', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['LIFE_TIME_VALUE']),
 'ENGAGEMENT_SCORE': FeatureConfig(name='ENGAGEMENT_SCORE', description='Combined engagement metric', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['SESSION_LENGTH', 'TIME_ON_APP', 'TIME_ON_WEBSITE']),
 'AVG_TRANSACTION_VALUE': FeatureConfig(name='AVG_TRANSACTION_VALUE', description='Average value per transaction', validation=FeatureValidationConfig(null_check=True, null_threshold=0.1, range_check=True, min_value=0.0, max_value=None, unique_check=False, unique_threshold=0.9), dependencies=['LIFE_TIME_VALUE', 'TRANSACTIONS'])}</code></pre>
</div>
</div>
</section>
</section>
<section id="step-5-feature-transformations" class="level2">
<h2 class="anchored" data-anchor-id="step-5-feature-transformations">Step 5: Feature Transformations</h2>
<p>Feature transformations convert raw data into ML-ready features. This is a critical step in the ML pipeline.</p>
<section id="why-transformations-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-transformations-matter">Why Transformations Matter</h3>
<p>Transformations serve multiple purposes: 1. <strong>Data Quality</strong>: Handle missing values and outliers 2. <strong>Feature Engineering</strong>: Create more predictive features 3. <strong>ML Requirements</strong>: Format data for model consumption 4. <strong>Business Logic</strong>: Encode domain knowledge</p>
</section>
<section id="types-of-transformations" class="level3">
<h3 class="anchored" data-anchor-id="types-of-transformations">Types of Transformations</h3>
<ol type="1">
<li><strong>Basic Transformations</strong>
<ul>
<li>Missing value imputation</li>
<li>Type conversion</li>
<li>Scaling/normalization</li>
</ul></li>
<li><strong>Time-Based Transformations</strong>
<ul>
<li>Rolling windows</li>
<li>Time since event</li>
<li>Seasonal patterns</li>
</ul></li>
<li><strong>Business Transformations</strong>
<ul>
<li>Derived metrics</li>
<li>Domain-specific calculations</li>
<li>Feature combinations</li>
</ul></li>
</ol>
</section>
<section id="ltv-specific-transformations" class="level3">
<h3 class="anchored" data-anchor-id="ltv-specific-transformations">LTV-Specific Transformations</h3>
<p>For LTV prediction, we need several key transformations:</p>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake.snowpark <span class="im">import</span> DataFrame</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Callable</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.transforms <span class="im">import</span> ValidationMixin</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomTransform(ValidationMixin):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Wrapper for custom transformations"""</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        transform_func: Callable[[DataFrame], DataFrame],</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        config: TransformConfig</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._transform <span class="op">=</span> transform_func</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._config <span class="op">=</span> config</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> config(<span class="va">self</span>) <span class="op">-&gt;</span> TransformConfig:</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._config</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, df: DataFrame) <span class="op">-&gt;</span> DataFrame:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._transform(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Default config if none provided</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>transform_config <span class="op">=</span> TransformConfig(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"ltv_transforms"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    null_threshold<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    expected_types<span class="op">=</span>[<span class="st">'DECIMAL'</span>, <span class="st">'DOUBLE'</span>, <span class="st">'NUMBER'</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>transforms <span class="op">=</span> [</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Handle Missing Values</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    fill_na(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'SESSION_LENGTH'</span>, <span class="st">'TIME_ON_APP'</span>, <span class="st">'TIME_ON_WEBSITE'</span>],</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        fill_value<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>TransformConfig(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"engagement_imputation"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Fill missing engagement metrics with 0"</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Time-Based Features</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    moving_agg(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        cols<span class="op">=</span>[<span class="st">'TRANSACTIONS'</span>, <span class="st">'LIFE_TIME_VALUE'</span>],</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        window_sizes<span class="op">=</span>[<span class="dv">7</span>, <span class="dv">30</span>],  <span class="co"># 7 and 30 day windows</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        agg_funcs<span class="op">=</span>[<span class="st">'SUM'</span>, <span class="st">'AVG'</span>],</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        partition_by<span class="op">=</span>[<span class="st">'CUSTOMER_ID'</span>],</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        order_by<span class="op">=</span>[<span class="st">'DATE'</span>],</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>TransformConfig(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"time_windows"</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Rolling window aggregations"</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Engagement Metrics</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    CustomTransform(</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        transform_func<span class="op">=</span><span class="kw">lambda</span> df: df.with_column(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ENGAGEMENT_SCORE'</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>            (F.col(<span class="st">'SESSION_LENGTH'</span>) <span class="op">+</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                F.col(<span class="st">'TIME_ON_APP'</span>) <span class="op">+</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                F.col(<span class="st">'TIME_ON_WEBSITE'</span>)) <span class="op">/</span> <span class="fl">3.0</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>TransformConfig(</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"engagement_score"</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Combined engagement metric"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>            expected_types<span class="op">=</span>[<span class="st">'DOUBLE'</span>]</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Transaction Metrics</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    CustomTransform(</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        transform_func<span class="op">=</span><span class="kw">lambda</span> df: df.with_column(</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'AVG_TRANSACTION_VALUE'</span>,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>            F.col(<span class="st">'LIFE_TIME_VALUE'</span>) <span class="op">/</span> </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>            F.when(F.col(<span class="st">'TRANSACTIONS'</span>) <span class="op">&gt;</span> <span class="dv">0</span>, F.col(<span class="st">'TRANSACTIONS'</span>))</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>            .otherwise(<span class="dv">1</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>TransformConfig(</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"avg_transaction_value"</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Average value per transaction"</span>,</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            expected_types<span class="op">=</span>[<span class="st">'DOUBLE'</span>]</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="best-practices-for-transformations" class="level3">
<h3 class="anchored" data-anchor-id="best-practices-for-transformations">Best Practices for Transformations</h3>
<ol type="1">
<li><strong>Validation</strong>
<ul>
<li>Check input data types</li>
<li>Validate output ranges</li>
<li>Monitor null ratios</li>
</ul></li>
<li><strong>Performance</strong>
<ul>
<li>Use vectorized operations</li>
<li>Minimize data movement</li>
<li>Leverage Snowflake optimizations</li>
</ul></li>
<li><strong>Documentation</strong>
<ul>
<li>Document business logic</li>
<li>Explain transformation choices</li>
<li>Track dependencies</li>
</ul></li>
</ol>
</section>
<section id="example-usage" class="level3">
<h3 class="anchored" data-anchor-id="example-usage">Example Usage</h3>
<p>Let’s apply our transformations and examine the results:</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.transforms <span class="im">import</span> apply_transforms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transforms</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> apply_transforms(df, transforms)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(transformed_df.show(<span class="dv">2</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>show <span class="op">=</span> <span class="va">False</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> show:</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show new features</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">New Features Created:"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    new_cols <span class="op">=</span> <span class="bu">set</span>(transformed_df.columns) <span class="op">-</span> <span class="bu">set</span>(df.columns)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> <span class="bu">sorted</span>(new_cols):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        transformed_df.select([</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            F.<span class="bu">min</span>(col).alias(<span class="st">'min'</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            F.<span class="bu">max</span>(col).alias(<span class="st">'max'</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            F.avg(col).alias(<span class="st">'mean'</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        ]).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|"CUSTOMER_ID"  |"DATE"      |"LIFE_TIME_VALUE"   |"SESSION_LENGTH"  |"TIME_ON_APP"       |"TIME_ON_WEBSITE"   |"TRANSACTIONS"  |"SUM_TRANSACTIONS_7"  |"AVG_TRANSACTIONS_7"  |"SUM_TRANSACTIONS_30"  |"AVG_TRANSACTIONS_30"  |"SUM_LIFE_TIME_VALUE_7"  |"AVG_LIFE_TIME_VALUE_7"  |"SUM_LIFE_TIME_VALUE_30"  |"AVG_LIFE_TIME_VALUE_30"  |"ENGAGEMENT_SCORE"  |"AVG_TRANSACTION_VALUE"  |
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|C17            |2025-01-27  |358.75645239371033  |0.0               |5.8309034937188144  |9.487293041019019   |3               |3.0                   |3.0                   |3.0                    |3.0                    |358.75645239371033       |358.75645239371033       |358.75645239371033        |358.75645239371033        |5.106065511579278   |119.58548413123678       |
|C17            |2025-01-28  |518.2970633604735   |0.0               |11.55870770225566   |10.304817307763335  |5               |8.0                   |4.0                   |8.0                    |4.0                    |877.0535157541839        |438.52675787709194       |877.0535157541839         |438.52675787709194        |7.287841670006332   |103.6594126720947        |
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

None</code></pre>
</div>
</div>
</section>
</section>
<section id="step-6-feature-view-creation" class="level2">
<h2 class="anchored" data-anchor-id="step-6-feature-view-creation">Step 6: Feature View Creation</h2>
<p>Feature views combine configurations, transformations, and source data into production-ready features.</p>
<section id="what-is-a-feature-view" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-feature-view">What is a Feature View?</h3>
<p>A feature view is: 1. <strong>Source Data</strong>: Raw data input 2. <strong>Transformations</strong>: Feature engineering logic 3. <strong>Configurations</strong>: Validation and refresh rules 4. <strong>Metadata</strong>: Documentation and lineage</p>
</section>
<section id="why-feature-views-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-feature-views-matter">Why Feature Views Matter</h3>
<p>Feature views provide: 1. <strong>Reproducibility</strong>: Consistent feature computation 2. <strong>Monitoring</strong>: Track feature health 3. <strong>Discovery</strong>: Make features findable 4. <strong>Governance</strong>: Control access and updates</p>
</section>
<section id="ltv-feature-view-design" class="level3">
<h3 class="anchored" data-anchor-id="ltv-feature-view-design">LTV Feature View Design</h3>
<p>For LTV prediction, our feature view needs to: 1. Combine engagement and transaction data 2. Apply time-based transformations 3. Maintain point-in-time correctness 4. Enable regular refreshes</p>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create feature view config</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>entity_name <span class="op">=</span> <span class="st">"CUSTOMER"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>feature_view_name <span class="op">=</span> <span class="st">"customer_ltv_features"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create feature view config</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> FeatureViewConfig(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span>feature_view_name,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span><span class="st">"RETAIL"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    entity<span class="op">=</span>entity_name,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    feature_type<span class="op">=</span><span class="st">"BEHAVIOR"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    refresh<span class="op">=</span>RefreshConfig(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        frequency<span class="op">=</span><span class="st">"1 day"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"INCREMENTAL"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    features<span class="op">=</span>feature_configs,  <span class="co">#  Created Above Pass the dictionary of FeatureConfigs</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"""</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="st">    Customer LTV prediction features combining:</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="st">    - Transaction history</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="st">    - Engagement metrics</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="st">    - Time-based patterns</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="st">    Updated daily with incremental processing.</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="st">    Use for LTV prediction and customer segmentation.</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>.strip(),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    timestamp_col<span class="op">=</span><span class="st">"DATE"</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create transformations</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Created above</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Create and register feature view</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>feature_view <span class="op">=</span> manager.add_feature_view(</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>config,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>df, <span class="co"># Original DataFrame above</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    entity_name<span class="op">=</span>entity_name,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    transforms<span class="op">=</span>transforms,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    collect_stats<span class="op">=</span><span class="va">True</span>  <span class="co"># Enable monitoring</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Log feature view details</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Created feature view: </span><span class="sc">{</span>feature_view_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Features created: </span><span class="sc">{</span><span class="bu">len</span>(feature_configs)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Transformations applied: </span><span class="sc">{</span><span class="bu">len</span>(transforms)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Show feature statistics</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Feature Statistics:"</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature_name, stats <span class="kw">in</span> manager.feature_stats[config.name].items():</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>feature_name<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="bu">str</span>(stats))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 18:58:47,395 - snowflake_feature_store - INFO - Validated feature LIFE_TIME_VALUE (stats: {'timestamp': '2025-02-27T02:58:46.549388', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 2.239592053174099, 'max_value': 749.1277222421559, 'mean_value': 371.0923268443173, 'std_value': 217.24439799534923})
2025-02-26 18:58:49,708 - snowflake_feature_store - INFO - Validated feature SESSION_LENGTH (stats: {'timestamp': '2025-02-27T02:58:47.764298', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 1908, 'min_value': 0.0, 'max_value': 12.219298377916665, 'mean_value': 4.924390829623488, 'std_value': 3.4026523269547897})
2025-02-26 18:58:51,019 - snowflake_feature_store - INFO - Validated feature TRANSACTIONS (stats: {'timestamp': '2025-02-27T02:58:50.110091', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 7, 'min_value': 1.0, 'max_value': 7.0, 'mean_value': 3.366667, 'std_value': 2.0001389951700856})
2025-02-26 18:58:52,525 - snowflake_feature_store - INFO - Validated feature SUM_TRANSACTIONS_7 (stats: {'timestamp': '2025-02-27T02:58:51.405251', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 39, 'min_value': 1.0, 'max_value': 39.0, 'mean_value': 20.647083333333335, 'std_value': 7.7325036694767615})
2025-02-26 18:58:54,016 - snowflake_feature_store - INFO - Validated feature AVG_TRANSACTIONS_7 (stats: {'timestamp': '2025-02-27T02:58:52.964874', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 82, 'min_value': 1.0, 'max_value': 7.0, 'mean_value': 3.3584570833333336, 'std_value': 0.9081127243491726})
2025-02-26 18:58:55,361 - snowflake_feature_store - INFO - Validated feature SUM_LIFE_TIME_VALUE_7 (stats: {'timestamp': '2025-02-27T02:58:54.404302', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 13.077530619670986, 'max_value': 4236.6778134791375, 'mean_value': 2274.693079593752, 'std_value': 855.943387600666})
2025-02-26 18:58:56,861 - snowflake_feature_store - INFO - Validated feature AVG_LIFE_TIME_VALUE_7 (stats: {'timestamp': '2025-02-27T02:58:55.772679', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 13.077530619670986, 'max_value': 746.5940585674848, 'mean_value': 370.0081979547277, 'std_value': 101.06575000463832})
2025-02-26 18:58:58,333 - snowflake_feature_store - INFO - Validated feature SUM_TRANSACTIONS_30 (stats: {'timestamp': '2025-02-27T02:58:57.353567', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 106, 'min_value': 1.0, 'max_value': 112.0, 'mean_value': 42.33708333333333, 'std_value': 24.726804909385617})
2025-02-26 18:58:59,571 - snowflake_feature_store - INFO - Validated feature AVG_TRANSACTIONS_30 (stats: {'timestamp': '2025-02-27T02:58:58.695444', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 409, 'min_value': 1.0, 'max_value': 7.0, 'mean_value': 3.3446108333333333, 'std_value': 0.7701141182408852})
2025-02-26 18:59:00,875 - snowflake_feature_store - INFO - Validated feature SUM_LIFE_TIME_VALUE_30 (stats: {'timestamp': '2025-02-27T02:58:59.948270', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 13.077530619670986, 'max_value': 12223.462666733421, 'mean_value': 4667.152806923684, 'std_value': 2730.693558396509})
2025-02-26 18:59:02,881 - snowflake_feature_store - INFO - Validated feature AVG_LIFE_TIME_VALUE_30 (stats: {'timestamp': '2025-02-27T02:59:01.831308', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 13.077530619670986, 'max_value': 746.5940585674848, 'mean_value': 368.6911018427686, 'std_value': 85.8407784959337})
2025-02-26 18:59:04,494 - snowflake_feature_store - INFO - Validated feature ENGAGEMENT_SCORE (stats: {'timestamp': '2025-02-27T02:59:03.545975', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 1.8904928435296238, 'max_value': 13.00033587035531, 'mean_value': 7.115458021279218, 'std_value': 2.360729920090712})
2025-02-26 18:59:06,030 - snowflake_feature_store - INFO - Validated feature AVG_TRANSACTION_VALUE (stats: {'timestamp': '2025-02-27T02:59:04.850674', 'row_count': 2400, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 2400, 'min_value': 2.239592053174099, 'max_value': 199.91701587497403, 'mean_value': 109.86392365044138, 'std_value': 31.398625475995402})
2025-02-26 18:59:32,339 - snowflake_feature_store - INFO - Created feature view: customer_ltv_features with 17 features
2025-02-26 18:59:32,352 - snowflake_feature_store - INFO - 
Created feature view: customer_ltv_features
2025-02-26 18:59:32,353 - snowflake_feature_store - INFO - Features created: 13
2025-02-26 18:59:32,354 - snowflake_feature_store - INFO - Transformations applied: 4
2025-02-26 18:59:32,354 - snowflake_feature_store - INFO - 
Feature Statistics:
2025-02-26 18:59:32,355 - snowflake_feature_store - INFO - 
LIFE_TIME_VALUE:
2025-02-26 18:59:32,356 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:11.568626
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 2.24
Max value: 749.13
Mean value: 371.09
Std dev: 217.24
2025-02-26 18:59:32,357 - snowflake_feature_store - INFO - 
SESSION_LENGTH:
2025-02-26 18:59:32,357 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:12.977411
Row count: 2400
Null count: 0 (0.0%)
Unique values: 1908
Min value: 0.00
Max value: 12.22
Mean value: 4.92
Std dev: 3.40
2025-02-26 18:59:32,357 - snowflake_feature_store - INFO - 
TRANSACTIONS:
2025-02-26 18:59:32,358 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:14.503363
Row count: 2400
Null count: 0 (0.0%)
Unique values: 7
Min value: 1.00
Max value: 7.00
Mean value: 3.37
Std dev: 2.00
2025-02-26 18:59:32,358 - snowflake_feature_store - INFO - 
SUM_TRANSACTIONS_7:
2025-02-26 18:59:32,359 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:16.021427
Row count: 2400
Null count: 0 (0.0%)
Unique values: 39
Min value: 1.00
Max value: 39.00
Mean value: 20.65
Std dev: 7.73
2025-02-26 18:59:32,359 - snowflake_feature_store - INFO - 
AVG_TRANSACTIONS_7:
2025-02-26 18:59:32,360 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:17.477578
Row count: 2400
Null count: 0 (0.0%)
Unique values: 82
Min value: 1.00
Max value: 7.00
Mean value: 3.36
Std dev: 0.91
2025-02-26 18:59:32,360 - snowflake_feature_store - INFO - 
SUM_LIFE_TIME_VALUE_7:
2025-02-26 18:59:32,360 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:19.190279
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 13.08
Max value: 4236.68
Mean value: 2274.69
Std dev: 855.94
2025-02-26 18:59:32,361 - snowflake_feature_store - INFO - 
AVG_LIFE_TIME_VALUE_7:
2025-02-26 18:59:32,361 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:20.605574
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 13.08
Max value: 746.59
Mean value: 370.01
Std dev: 101.07
2025-02-26 18:59:32,361 - snowflake_feature_store - INFO - 
SUM_TRANSACTIONS_30:
2025-02-26 18:59:32,362 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:22.053484
Row count: 2400
Null count: 0 (0.0%)
Unique values: 106
Min value: 1.00
Max value: 112.00
Mean value: 42.34
Std dev: 24.73
2025-02-26 18:59:32,362 - snowflake_feature_store - INFO - 
AVG_TRANSACTIONS_30:
2025-02-26 18:59:32,362 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:23.531577
Row count: 2400
Null count: 0 (0.0%)
Unique values: 409
Min value: 1.00
Max value: 7.00
Mean value: 3.34
Std dev: 0.77
2025-02-26 18:59:32,362 - snowflake_feature_store - INFO - 
SUM_LIFE_TIME_VALUE_30:
2025-02-26 18:59:32,363 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:25.307538
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 13.08
Max value: 12223.46
Mean value: 4667.15
Std dev: 2730.69
2025-02-26 18:59:32,363 - snowflake_feature_store - INFO - 
AVG_LIFE_TIME_VALUE_30:
2025-02-26 18:59:32,363 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:27.239169
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 13.08
Max value: 746.59
Mean value: 368.69
Std dev: 85.84
2025-02-26 18:59:32,364 - snowflake_feature_store - INFO - 
ENGAGEMENT_SCORE:
2025-02-26 18:59:32,364 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:29.019741
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 1.89
Max value: 13.00
Mean value: 7.12
Std dev: 2.36
2025-02-26 18:59:32,364 - snowflake_feature_store - INFO - 
AVG_TRANSACTION_VALUE:
2025-02-26 18:59:32,364 - snowflake_feature_store - INFO - Timestamp: 2025-02-27T02:59:31.280304
Row count: 2400
Null count: 0 (0.0%)
Unique values: 2400
Min value: 2.24
Max value: 199.92
Mean value: 109.86
Std dev: 31.40</code></pre>
</div>
</div>
</section>
<section id="best-practices-for-feature-views" class="level3">
<h3 class="anchored" data-anchor-id="best-practices-for-feature-views">Best Practices for Feature Views</h3>
<ol type="1">
<li><strong>Documentation</strong>
<ul>
<li>Clear descriptions</li>
<li>Usage examples</li>
<li>Update frequency</li>
<li>Dependencies</li>
</ul></li>
<li><strong>Monitoring</strong>
<ul>
<li>Feature statistics</li>
<li>Data quality metrics</li>
<li>Refresh status</li>
<li>Drift detection</li>
</ul></li>
<li><strong>Performance</strong>
<ul>
<li>Incremental updates</li>
<li>Efficient transformations</li>
<li>Appropriate refresh schedule</li>
</ul></li>
<li><strong>Governance</strong>
<ul>
<li>Access controls</li>
<li>Version control</li>
<li>Audit logging</li>
<li>Data lineage</li>
</ul></li>
</ol>
</section>
</section>
<section id="step-7-feature-monitoring" class="level2">
<h2 class="anchored" data-anchor-id="step-7-feature-monitoring">Step 7: Feature Monitoring</h2>
<p>Monitoring is crucial for maintaining feature quality and detecting issues early.</p>
<section id="why-monitor-features" class="level3">
<h3 class="anchored" data-anchor-id="why-monitor-features">Why Monitor Features?</h3>
<p>Feature monitoring helps: 1. <strong>Detect Data Quality Issues</strong>: Missing values, outliers, type mismatches 2. <strong>Track Feature Drift</strong>: Changes in feature distributions 3. <strong>Ensure Freshness</strong>: Verify timely updates 4. <strong>Validate Business Rules</strong>: Check domain-specific constraints</p>
</section>
<section id="types-of-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="types-of-monitoring">Types of Monitoring</h3>
<ol type="1">
<li><strong>Data Quality</strong>
<ul>
<li>Null ratios</li>
<li>Type consistency</li>
<li>Value ranges</li>
<li>Cardinality</li>
</ul></li>
<li><strong>Statistical Monitoring</strong>
<ul>
<li>Distribution shifts</li>
<li>Correlation changes</li>
<li>Seasonality patterns</li>
<li>Outlier detection</li>
</ul></li>
<li><strong>Operational Monitoring</strong>
<ul>
<li>Refresh status</li>
<li>Computation time</li>
<li>Resource usage</li>
<li>Error rates</li>
</ul></li>
</ol>
</section>
<section id="ltv-specific-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="ltv-specific-monitoring">LTV-Specific Monitoring</h3>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Union, List, Callable, Optional, Protocol, Dict, Any</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> decimal</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LTVMonitor:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Monitor for LTV feature quality and drift"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        manager: FeatureStoreManager,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        feature_view_name: <span class="bu">str</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        metrics_path: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.manager <span class="op">=</span> manager</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.feature_view_name <span class="op">=</span> feature_view_name</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.metrics_path <span class="op">=</span> metrics_path</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.baseline_stats <span class="op">=</span> {}</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_decimal(<span class="va">self</span>, obj: Any) <span class="op">-&gt;</span> Any:</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Convert Decimal objects to float for JSON serialization"""</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(obj, decimal.Decimal):</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">float</span>(obj)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> obj</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _process_metrics(<span class="va">self</span>, metrics: Dict) <span class="op">-&gt;</span> Dict:</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process metrics dictionary to ensure JSON serializable values"""</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>            k: {</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">'timestamp'</span>: v[<span class="st">'timestamp'</span>],</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">'metrics'</span>: {</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                    mk: <span class="va">self</span>._convert_decimal(mv)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> mk, mv <span class="kw">in</span> v[<span class="st">'metrics'</span>].items()</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> k, v <span class="kw">in</span> metrics.items()</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compute_feature_metrics(</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        df: DataFrame,</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        timestamp: Optional[datetime] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Dict]:</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute comprehensive feature metrics"""</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>        metrics <span class="op">=</span> {}</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        timestamp <span class="op">=</span> timestamp <span class="kw">or</span> datetime.now()</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Skip identifier columns</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> [<span class="st">'CUSTOMER_ID'</span>, <span class="st">'DATE'</span>]:</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Basic stats</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> df.select([</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>                F.count(col).alias(<span class="st">'count'</span>),</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                F.count_distinct(col).alias(<span class="st">'unique'</span>),</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>                F.<span class="bu">sum</span>(F.when(F.col(col).is_null(), <span class="dv">1</span>).otherwise(<span class="dv">0</span>)).alias(<span class="st">'nulls'</span>)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            ]).collect()[<span class="dv">0</span>].asDict()</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert Decimal to float</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> {k: <span class="va">self</span>._convert_decimal(v) <span class="cf">for</span> k, v <span class="kw">in</span> stats.items()}</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Numeric stats for appropriate columns</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> [<span class="st">'LIFE_TIME_VALUE'</span>, <span class="st">'SESSION_LENGTH'</span>, <span class="st">'TRANSACTIONS'</span>]:</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>                numeric_stats <span class="op">=</span> df.select([</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>                    F.<span class="bu">min</span>(col).alias(<span class="st">'min'</span>),</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>                    F.<span class="bu">max</span>(col).alias(<span class="st">'max'</span>),</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>                    F.avg(col).alias(<span class="st">'mean'</span>),</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>                    F.stddev(col).alias(<span class="st">'std'</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>                ]).collect()[<span class="dv">0</span>].asDict()</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Convert Decimal to float</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>                numeric_stats <span class="op">=</span> {k: <span class="va">self</span>._convert_decimal(v) <span class="cf">for</span> k, v <span class="kw">in</span> numeric_stats.items()}</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>                stats.update(numeric_stats)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>            metrics[col] <span class="op">=</span> {</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">'timestamp'</span>: timestamp.isoformat(),</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">'metrics'</span>: stats</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> metrics</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_baseline(<span class="va">self</span>, df: DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Set baseline statistics for drift detection"""</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.baseline_stats <span class="op">=</span> <span class="va">self</span>.compute_feature_metrics(df)</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Set baseline statistics"</span>)</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save baseline if metrics path provided</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.metrics_path:</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>            baseline_file <span class="op">=</span> Path(<span class="va">self</span>.metrics_path) <span class="op">/</span> <span class="st">"baseline_stats.json"</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>            processed_stats <span class="op">=</span> <span class="va">self</span>._process_metrics(<span class="va">self</span>.baseline_stats)</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(baseline_file, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>                json.dump(processed_stats, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_feature_health(</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>        df: DataFrame,</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>        drift_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check overall feature health"""</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute current metrics</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>            current_metrics <span class="op">=</span> <span class="va">self</span>.compute_feature_metrics(df)</span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Detect drift if baseline exists</span></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.baseline_stats:</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>                drift_alerts <span class="op">=</span> <span class="va">self</span>.detect_drift(</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>                    current_metrics,</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>                    drift_threshold</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> drift_alerts:</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>                    logger.warning(<span class="st">"</span><span class="ch">\n</span><span class="st">Feature Drift Detected:"</span>)</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> feature, alerts <span class="kw">in</span> drift_alerts.items():</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>                        logger.warning(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> alert <span class="kw">in</span> alerts:</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>                            logger.warning(<span class="ss">f"- </span><span class="sc">{</span>alert<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log current metrics</span></span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Feature Metrics:"</span>)</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> feature, metrics <span class="kw">in</span> current_metrics.items():</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> metric, value <span class="kw">in</span> metrics[<span class="st">'metrics'</span>].items():</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>                    logger.info(<span class="ss">f"  </span><span class="sc">{</span>metric<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save metrics if path provided</span></span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.metrics_path:</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>                metrics_file <span class="op">=</span> Path(<span class="va">self</span>.metrics_path) <span class="op">/</span> <span class="ss">f"metrics_</span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">_%H%M%S'</span>)<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>                processed_metrics <span class="op">=</span> <span class="va">self</span>._process_metrics(current_metrics)</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(metrics_file, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>                    json.dump(processed_metrics, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"Error checking feature health: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> detect_drift(</span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>        current_metrics: Dict,</span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>        drift_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Detect significant changes in feature distributions"""</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>        drift_alerts <span class="op">=</span> {}</span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> feature, metrics <span class="kw">in</span> current_metrics.items():</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> feature <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.baseline_stats:</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>            alerts <span class="op">=</span> []</span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>            baseline <span class="op">=</span> <span class="va">self</span>.baseline_stats[feature][<span class="st">'metrics'</span>]</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>            current <span class="op">=</span> metrics[<span class="st">'metrics'</span>]</span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check for distribution changes</span></span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> metric <span class="kw">in</span> [<span class="st">'mean'</span>, <span class="st">'std'</span>]:</span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> metric <span class="kw">not</span> <span class="kw">in</span> current <span class="kw">or</span> metric <span class="kw">not</span> <span class="kw">in</span> baseline:</span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>                change <span class="op">=</span> <span class="bu">abs</span>(current[metric] <span class="op">-</span> baseline[metric]) <span class="op">/</span> baseline[metric]</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> change <span class="op">&gt;</span> drift_threshold:</span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>                    alerts.append(</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f"</span><span class="sc">{</span>metric<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss"> changed by </span><span class="sc">{</span>change<span class="sc">:.1%}</span><span class="ss">"</span></span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check for data quality changes</span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>            null_ratio <span class="op">=</span> current[<span class="st">'NULLS'</span>] <span class="op">/</span> current[<span class="st">'COUNT'</span>]</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>            baseline_null_ratio <span class="op">=</span> baseline[<span class="st">'NULLS'</span>] <span class="op">/</span> baseline[<span class="st">'COUNT'</span>]</span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(null_ratio <span class="op">-</span> baseline_null_ratio) <span class="op">&gt;</span> drift_threshold:</span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>                alerts.append(</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"NULL ratio changed from </span><span class="sc">{</span>baseline_null_ratio<span class="sc">:.1%}</span><span class="ss"> to </span><span class="sc">{</span>null_ratio<span class="sc">:.1%}</span><span class="ss">"</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> alerts:</span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>                drift_alerts[feature] <span class="op">=</span> alerts</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> drift_alerts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-usage-1" class="level3">
<h3 class="anchored" data-anchor-id="example-usage-1">Example Usage</h3>
<p>Let’s set up monitoring for our LTV features:</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up metrics directory</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>metrics_dir <span class="op">=</span> Path(<span class="st">"feature_metrics"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>metrics_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up monitoring</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>monitor <span class="op">=</span> LTVMonitor(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">=</span>manager,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    feature_view_name<span class="op">=</span>feature_view.name,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    metrics_path<span class="op">=</span><span class="bu">str</span>(metrics_dir)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake_feature_store.examples <span class="im">import</span> get_example_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set baseline</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>monitor.set_baseline(feature_view.feature_df)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some drift</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>drift_df <span class="op">=</span> get_example_data(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    conn.session,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    schema,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    num_customers<span class="op">=</span><span class="dv">250</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ltv_multiplier<span class="op">=</span><span class="fl">4.5</span>,  <span class="co"># Increase values to simulate drift</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    table_type <span class="op">=</span> <span class="st">'TEST'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for drift</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>monitor.check_feature_health(drift_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 19:00:15,844 - snowflake_feature_store - INFO - Set baseline statistics
2025-02-26 19:00:22,871 - snowflake_feature_store - INFO - Generated 6000 rows of demo data in "DATASCIENCE".FEATURE_STORE_DEMO.CUSTOMER_ACTIVITY_TEST
2025-02-26 19:00:22,874 - snowflake_feature_store - INFO - 
Sample Data:
---------------------------------------------------------------------------------------------------------------------------------
|"CUSTOMER_ID"  |"DATE"      |"LIFE_TIME_VALUE"  |"SESSION_LENGTH"   |"TIME_ON_APP"       |"TIME_ON_WEBSITE"   |"TRANSACTIONS"  |
---------------------------------------------------------------------------------------------------------------------------------
|C26            |2025-01-27  |564.6091706355498  |7.616530664264483  |12.142466259190991  |10.138495747448552  |5               |
|C85            |2025-02-25  |59.41299820191271  |4.727356127459224  |5.495725181799517   |3.859344227079125   |1               |
|C72            |2025-02-25  |646.3111447043822  |8.908367451703572  |9.728204471331994   |13.191869376320893  |6               |
|C60            |2025-02-25  |447.0367329096978  |8.704973243200099  |10.936684313415565  |11.222118890927462  |4               |
|C48            |2025-02-25  |294.3029664683961  |NULL               |5.2542111627227275  |7.048625379945507   |2               |
---------------------------------------------------------------------------------------------------------------------------------

2025-02-26 19:00:23,220 - snowflake_feature_store - INFO - 
Schema:
2025-02-26 19:00:23,346 - snowflake_feature_store - INFO - CUSTOMER_ID: StringType()
2025-02-26 19:00:23,348 - snowflake_feature_store - INFO - DATE: DateType()
2025-02-26 19:00:23,349 - snowflake_feature_store - INFO - LIFE_TIME_VALUE: DoubleType()
2025-02-26 19:00:23,350 - snowflake_feature_store - INFO - SESSION_LENGTH: DoubleType()
2025-02-26 19:00:23,351 - snowflake_feature_store - INFO - TIME_ON_APP: DoubleType()
2025-02-26 19:00:23,352 - snowflake_feature_store - INFO - TIME_ON_WEBSITE: DoubleType()
2025-02-26 19:00:23,353 - snowflake_feature_store - INFO - TRANSACTIONS: LongType()
2025-02-26 19:00:25,574 - snowflake_feature_store - WARNING - 
Feature Drift Detected:
2025-02-26 19:00:25,576 - snowflake_feature_store - WARNING - 
SESSION_LENGTH:
2025-02-26 19:00:25,577 - snowflake_feature_store - WARNING - - NULL ratio changed from 0.0% to 25.9%
2025-02-26 19:00:25,577 - snowflake_feature_store - INFO - 
Current Feature Metrics:
2025-02-26 19:00:25,578 - snowflake_feature_store - INFO - 
LIFE_TIME_VALUE:
2025-02-26 19:00:25,579 - snowflake_feature_store - INFO -   COUNT: 2400
2025-02-26 19:00:25,580 - snowflake_feature_store - INFO -   UNIQUE: 2400
2025-02-26 19:00:25,580 - snowflake_feature_store - INFO -   NULLS: 0
2025-02-26 19:00:25,581 - snowflake_feature_store - INFO -   MIN: 2.239592053174099
2025-02-26 19:00:25,581 - snowflake_feature_store - INFO -   MAX: 749.1277222421559
2025-02-26 19:00:25,582 - snowflake_feature_store - INFO -   MEAN: 371.0923268443173
2025-02-26 19:00:25,583 - snowflake_feature_store - INFO -   STD: 217.24439799534923
2025-02-26 19:00:25,583 - snowflake_feature_store - INFO - 
SESSION_LENGTH:
2025-02-26 19:00:25,584 - snowflake_feature_store - INFO -   COUNT: 1907
2025-02-26 19:00:25,585 - snowflake_feature_store - INFO -   UNIQUE: 1907
2025-02-26 19:00:25,585 - snowflake_feature_store - INFO -   NULLS: 493
2025-02-26 19:00:25,586 - snowflake_feature_store - INFO -   MIN: 0.08102027782085003
2025-02-26 19:00:25,587 - snowflake_feature_store - INFO -   MAX: 12.219298377916665
2025-02-26 19:00:25,587 - snowflake_feature_store - INFO -   MEAN: 6.197450441057352
2025-02-26 19:00:25,588 - snowflake_feature_store - INFO -   STD: 2.584360647215551
2025-02-26 19:00:25,588 - snowflake_feature_store - INFO - 
TIME_ON_APP:
2025-02-26 19:00:25,589 - snowflake_feature_store - INFO -   COUNT: 2400
2025-02-26 19:00:25,589 - snowflake_feature_store - INFO -   UNIQUE: 2400
2025-02-26 19:00:25,589 - snowflake_feature_store - INFO -   NULLS: 0
2025-02-26 19:00:25,590 - snowflake_feature_store - INFO - 
TIME_ON_WEBSITE:
2025-02-26 19:00:25,591 - snowflake_feature_store - INFO -   COUNT: 2400
2025-02-26 19:00:25,592 - snowflake_feature_store - INFO -   UNIQUE: 2400
2025-02-26 19:00:25,592 - snowflake_feature_store - INFO -   NULLS: 0
2025-02-26 19:00:25,593 - snowflake_feature_store - INFO - 
TRANSACTIONS:
2025-02-26 19:00:25,593 - snowflake_feature_store - INFO -   COUNT: 2400
2025-02-26 19:00:25,593 - snowflake_feature_store - INFO -   UNIQUE: 7
2025-02-26 19:00:25,594 - snowflake_feature_store - INFO -   NULLS: 0
2025-02-26 19:00:25,594 - snowflake_feature_store - INFO -   MIN: 1
2025-02-26 19:00:25,595 - snowflake_feature_store - INFO -   MAX: 7
2025-02-26 19:00:25,595 - snowflake_feature_store - INFO -   MEAN: 3.366667
2025-02-26 19:00:25,596 - snowflake_feature_store - INFO -   STD: 2.0001389951700856</code></pre>
</div>
</div>
</section>
</section>
<section id="step-8-training-data-generation" class="level2">
<h2 class="anchored" data-anchor-id="step-8-training-data-generation">Step 8: Training Data Generation</h2>
<p>Generating training data from a feature store requires special consideration to avoid data leakage and ensure point-in-time correctness.</p>
<section id="why-training-data-generation-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-training-data-generation-matters">Why Training Data Generation Matters</h3>
<p>Proper training data generation: 1. <strong>Prevents Data Leakage</strong>: Ensures future data doesn’t leak into training 2. <strong>Maintains Consistency</strong>: Uses same feature computations as production 3. <strong>Enables Reproducibility</strong>: Training sets can be recreated exactly 4. <strong>Supports Experimentation</strong>: Easy to create different feature combinations</p>
</section>
<section id="ltv-training-data-requirements" class="level3">
<h3 class="anchored" data-anchor-id="ltv-training-data-requirements">LTV Training Data Requirements</h3>
<p>For LTV prediction, we need to: 1. Use historical data to predict future LTV 2. Include time-based features correctly 3. Handle missing values consistently 4. Maintain customer context</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>metrics_dir <span class="op">=</span> Path(tempfile.mkdtemp()) <span class="op">/</span> <span class="st">"feature_store_metrics"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>training_start_date<span class="op">=</span><span class="st">'2025-01-01'</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>training_end_date<span class="op">=</span><span class="st">'2025-03-01'</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>prediction_window<span class="op">=</span><span class="dv">90</span>  <span class="co"># Predict 90-day LTV</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>save_table<span class="op">=</span><span class="st">'DATASCIENCE.FEATURE_STORE_DEMO.LTV_TRAINING_DATA'</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>manager <span class="op">=</span> FeatureStoreManager(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    connection<span class="op">=</span>conn,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    metrics_path<span class="op">=</span>metrics_dir,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    overwrite<span class="op">=</span><span class="va">True</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get existing feature view</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>feature_view <span class="op">=</span> manager.feature_store.get_feature_view(</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"customer_ltv_features"</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"V1_0"</span>  <span class="co"># Use the version from earlier</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 19:01:11,456 - snowflake_feature_store - INFO - FeatureStoreManager initialized</code></pre>
</div>
</div>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the fully qualified table name</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> (</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>manager<span class="sc">.</span>connection<span class="sc">.</span>database<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>manager<span class="sc">.</span>connection<span class="sc">.</span>schema<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"CUSTOMER_ACTIVITY"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create spine query for point-in-time correct features</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>spine_df <span class="op">=</span> manager.connection.session.sql(<span class="ss">f"""</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    WITH customer_dates AS (</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ss">        -- Get all customer-date combinations</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT DISTINCT</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ss">            CUSTOMER_ID,</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ss">            DATE</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM </span><span class="sc">{</span>table_name<span class="sc">}</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE DATE BETWEEN '</span><span class="sc">{</span>training_start_date<span class="sc">}</span><span class="ss">' AND '</span><span class="sc">{</span>training_end_date<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    ),</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ss">    future_ltv AS (</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="ss">        -- Calculate future LTV for each customer-date</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT </span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="ss">            cd.CUSTOMER_ID,</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="ss">            cd.DATE as FEATURE_DATE,</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(f.DATE) as LABEL_DATE,</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="ss">            MAX(f.LIFE_TIME_VALUE) as FUTURE_LTV</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM customer_dates cd</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="ss">        LEFT JOIN </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss"> f</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="ss">            ON cd.CUSTOMER_ID = f.CUSTOMER_ID</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="ss">            AND f.DATE BETWEEN cd.DATE </span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="ss">                AND DATEADD(days, </span><span class="sc">{</span>prediction_window<span class="sc">}</span><span class="ss">, cd.DATE)</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY 1, 2</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="ss">)</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="ss">    -- Final spine query</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT </span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="ss">        CUSTOMER_ID,</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="ss">        FEATURE_DATE as "DATE",</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="ss">        FUTURE_LTV as "TARGET_LTV",</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="ss">        LABEL_DATE as "LABEL_DATE"</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM future_ltv</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>spine_df.show(<span class="dv">2</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Created spine with </span><span class="sc">{</span>spine_df<span class="sc">.</span>count()<span class="sc">}</span><span class="ss"> rows"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------
|"CUSTOMER_ID"  |"DATE"      |"TARGET_LTV"       |"LABEL_DATE"  |
-----------------------------------------------------------------
|C26            |2025-01-27  |740.132663156064   |2025-02-25    |
|C85            |2025-02-25  |59.41299820191271  |2025-02-25    |
-----------------------------------------------------------------

2025-02-26 19:01:24,224 - snowflake_feature_store - INFO - Created spine with 2400 rows</code></pre>
</div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get features using point-in-time correct joins</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>training_data <span class="op">=</span> manager.get_features(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    spine_df<span class="op">=</span>spine_df,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    feature_views<span class="op">=</span>[feature_view],</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    spine_timestamp_col<span class="op">=</span><span class="st">"DATE"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    label_cols<span class="op">=</span>[<span class="st">"TARGET_LTV"</span>, <span class="st">"LABEL_DATE"</span>]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample Data:"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>training_data.show(<span class="dv">2</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Schema:"</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> field <span class="kw">in</span> training_data.schema.fields:</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"</span><span class="sc">{</span>field<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>field<span class="sc">.</span>datatype<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 19:01:30,389 - snowflake_feature_store - INFO - Spine DataFrame columns: ['CUSTOMER_ID', 'DATE', 'TARGET_LTV', 'LABEL_DATE']
2025-02-26 19:01:30,390 - snowflake_feature_store - INFO - Spine DataFrame schema: StructType([StructField('CUSTOMER_ID', StringType(), nullable=True), StructField('DATE', DateType(), nullable=True), StructField('TARGET_LTV', DoubleType(), nullable=True), StructField('LABEL_DATE', DateType(), nullable=True)])
2025-02-26 19:01:30,390 - snowflake_feature_store - INFO - Generating dataset with name: DATASET_20250227_030130_63cf45e6
2025-02-26 19:01:30,390 - snowflake_feature_store - INFO - Label columns: ['"TARGET_LTV"', '"LABEL_DATE"']
2025-02-26 19:01:30,390 - snowflake_feature_store - INFO - Timestamp column: "DATE"
2025-02-26 19:01:34,597 - snowflake_feature_store - INFO - 
Sample Data:
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|"CUSTOMER_ID"  |"DATE"      |"TARGET_LTV"       |"LABEL_DATE"  |"LIFE_TIME_VALUE"   |"SESSION_LENGTH"   |"TIME_ON_APP"      |"TIME_ON_WEBSITE"   |"TRANSACTIONS"  |"SUM_TRANSACTIONS_7"  |"AVG_TRANSACTIONS_7"  |"SUM_TRANSACTIONS_30"  |"AVG_TRANSACTIONS_30"  |"SUM_LIFE_TIME_VALUE_7"  |"AVG_LIFE_TIME_VALUE_7"  |"SUM_LIFE_TIME_VALUE_30"  |"AVG_LIFE_TIME_VALUE_30"  |"ENGAGEMENT_SCORE"  |"AVG_TRANSACTION_VALUE"  |
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|C54            |2025-01-27  |748.4986572265625  |2025-02-25    |473.930419921875    |8.07875919342041   |8.7145357131958    |11.581034660339355  |4               |4.0                   |4.0                   |4.0                    |4.0                    |473.930419921875         |473.930419921875         |473.930419921875          |473.930419921875          |9.458109855651855   |118.48260498046875       |
|C54            |2025-01-28  |748.4986572265625  |2025-02-25    |258.25628662109375  |5.443594455718994  |6.002151012420654  |5.871957778930664   |2               |6.0                   |3.0                   |6.0                    |3.0                    |732.1867065429688        |366.0933532714844        |732.1867065429688         |366.0933532714844         |5.7725677490234375  |129.12814331054688       |
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

2025-02-26 19:01:35,803 - snowflake_feature_store - INFO - 
Schema:
2025-02-26 19:01:35,805 - snowflake_feature_store - INFO - CUSTOMER_ID: StringType()
2025-02-26 19:01:35,805 - snowflake_feature_store - INFO - DATE: DateType()
2025-02-26 19:01:35,806 - snowflake_feature_store - INFO - TARGET_LTV: DoubleType()
2025-02-26 19:01:35,807 - snowflake_feature_store - INFO - LABEL_DATE: DateType()
2025-02-26 19:01:35,807 - snowflake_feature_store - INFO - LIFE_TIME_VALUE: DoubleType()
2025-02-26 19:01:35,808 - snowflake_feature_store - INFO - SESSION_LENGTH: DoubleType()
2025-02-26 19:01:35,809 - snowflake_feature_store - INFO - TIME_ON_APP: DoubleType()
2025-02-26 19:01:35,809 - snowflake_feature_store - INFO - TIME_ON_WEBSITE: DoubleType()
2025-02-26 19:01:35,810 - snowflake_feature_store - INFO - TRANSACTIONS: LongType()
2025-02-26 19:01:35,811 - snowflake_feature_store - INFO - SUM_TRANSACTIONS_7: DoubleType()
2025-02-26 19:01:35,811 - snowflake_feature_store - INFO - AVG_TRANSACTIONS_7: DoubleType()
2025-02-26 19:01:35,812 - snowflake_feature_store - INFO - SUM_TRANSACTIONS_30: DoubleType()
2025-02-26 19:01:35,812 - snowflake_feature_store - INFO - AVG_TRANSACTIONS_30: DoubleType()
2025-02-26 19:01:35,813 - snowflake_feature_store - INFO - SUM_LIFE_TIME_VALUE_7: DoubleType()
2025-02-26 19:01:35,813 - snowflake_feature_store - INFO - AVG_LIFE_TIME_VALUE_7: DoubleType()
2025-02-26 19:01:35,814 - snowflake_feature_store - INFO - SUM_LIFE_TIME_VALUE_30: DoubleType()
2025-02-26 19:01:35,814 - snowflake_feature_store - INFO - AVG_LIFE_TIME_VALUE_30: DoubleType()
2025-02-26 19:01:35,815 - snowflake_feature_store - INFO - ENGAGEMENT_SCORE: DoubleType()
2025-02-26 19:01:35,815 - snowflake_feature_store - INFO - AVG_TRANSACTION_VALUE: DoubleType()</code></pre>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add metadata columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>training_data <span class="op">=</span> training_data.select(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,  <span class="co"># Keep all existing columns</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    F.lit(training_start_date).alias(<span class="st">"TRAINING_START_DATE"</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    F.lit(training_end_date).alias(<span class="st">"TRAINING_END_DATE"</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    F.lit(prediction_window).alias(<span class="st">"PREDICTION_WINDOW_DAYS"</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    F.current_timestamp().alias(<span class="st">"GENERATED_AT"</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Save if table name provided</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> save_table:</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    training_data.write.mode(<span class="st">"overwrite"</span>).save_as_table(save_table)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Saved training data to </span><span class="sc">{</span>save_table<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Log data generation stats</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Training Data Statistics:"</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Total rows: </span><span class="sc">{</span>training_data<span class="sc">.</span>count()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Date range: </span><span class="sc">{</span>training_start_date<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>training_end_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Prediction window: </span><span class="sc">{</span>prediction_window<span class="sc">}</span><span class="ss"> days"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-26 19:01:40,964 - snowflake_feature_store - INFO - Saved training data to DATASCIENCE.FEATURE_STORE_DEMO.LTV_TRAINING_DATA
2025-02-26 19:01:40,965 - snowflake_feature_store - INFO - 
Training Data Statistics:
2025-02-26 19:01:41,855 - snowflake_feature_store - INFO - Total rows: 2400
2025-02-26 19:01:41,857 - snowflake_feature_store - INFO - Date range: 2025-01-01 to 2025-03-01
2025-02-26 19:01:41,858 - snowflake_feature_store - INFO - Prediction window: 90 days</code></pre>
</div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> rm <span class="op">-</span>rf feature_metrics<span class="op">/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="best-practices-for-training-data" class="level3">
<h3 class="anchored" data-anchor-id="best-practices-for-training-data">Best Practices for Training Data</h3>
<ol type="1">
<li><strong>Time Windows</strong>
<ul>
<li>Use appropriate training/validation splits</li>
<li>Consider seasonal patterns</li>
<li>Match prediction window to business needs</li>
</ul></li>
<li><strong>Feature Selection</strong>
<ul>
<li>Include all relevant features</li>
<li>Document feature importance</li>
<li>Track feature dependencies</li>
</ul></li>
<li><strong>Data Quality</strong>
<ul>
<li>Handle missing values consistently</li>
<li>Check for data leakage</li>
<li>Validate label quality</li>
</ul></li>
<li><strong>Documentation</strong>
<ul>
<li>Record generation parameters</li>
<li>Track data lineage</li>
<li>Document assumptions</li>
</ul></li>
</ol>
</section>
</section>
<section id="conclusion-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-and-next-steps">Conclusion and Next Steps</h2>
<section id="what-weve-built" class="level3">
<h3 class="anchored" data-anchor-id="what-weve-built">What We’ve Built</h3>
<p>We’ve created a comprehensive example of using Snowflake’s Feature Store for LTV prediction that demonstrates: 1. <strong>Feature Store Setup</strong>: Creating and managing a feature store 2. <strong>Entity Management</strong>: Defining and documenting customer entities 3. <strong>Feature Engineering</strong>: Creating and transforming features 4. <strong>Feature Views</strong>: Organizing and versioning features 5. <strong>Monitoring</strong>: Tracking feature quality and drift 6. <strong>Training Data</strong>: Generating point-in-time correct datasets</p>
</section>
<section id="potential-enhancements" class="level3">
<h3 class="anchored" data-anchor-id="potential-enhancements">Potential Enhancements</h3>
<p>Future versions could include: 1. <strong>Advanced Monitoring</strong> - Automated drift detection alerts - Custom validation rules - Feature quality dashboards - Historical metrics tracking</p>
<ol start="2" type="1">
<li><strong>Feature Discovery</strong>
<ul>
<li>Feature search capabilities</li>
<li>Metadata management</li>
<li>Usage tracking</li>
<li>Documentation generation</li>
</ul></li>
<li><strong>Production Integration</strong>
<ul>
<li>CI/CD pipeline integration</li>
<li>Automated testing</li>
<li>Deployment workflows</li>
<li>Model registry integration</li>
</ul></li>
<li><strong>Performance Optimization</strong>
<ul>
<li>Incremental updates</li>
<li>Caching strategies</li>
<li>Query optimization</li>
<li>Resource management</li>
</ul></li>
</ol>
</section>
<section id="best-practices" class="level3">
<h3 class="anchored" data-anchor-id="best-practices">Best Practices</h3>
<p>When using this template: 1. <strong>Documentation</strong> - Document feature definitions - Explain business logic - Track dependencies - Maintain version history</p>
<ol start="2" type="1">
<li><strong>Testing</strong>
<ul>
<li>Validate feature logic</li>
<li>Check data quality</li>
<li>Test transformations</li>
<li>Verify point-in-time correctness</li>
</ul></li>
<li><strong>Monitoring</strong>
<ul>
<li>Set up drift detection</li>
<li>Track feature freshness</li>
<li>Monitor data quality</li>
<li>Alert on issues</li>
</ul></li>
<li><strong>Governance</strong>
<ul>
<li>Manage access controls</li>
<li>Track lineage</li>
<li>Enforce standards</li>
<li>Maintain audit logs</li>
</ul></li>
</ol>
</section>
<section id="using-this-template" class="level3">
<h3 class="anchored" data-anchor-id="using-this-template">Using This Template</h3>
<p>To adapt this example: 1. Replace LTV-specific logic with your use case 2. Adjust feature definitions and transformations 3. Customize monitoring thresholds 4. Add domain-specific validation</p>
</section>
<section id="resources" class="level3">
<h3 class="anchored" data-anchor-id="resources">Resources</h3>
<p>For more information: 1. <a href="https://docs.snowflake.com/en/user-guide/feature-store">Snowflake Feature Store Documentation</a> 2. <a href="https://docs.snowflake.com/en/user-guide/feature-store-use">Feature Store Best Practices</a> 3. <a href="https://docs.snowflake.com/en/developer-guide/snowpark-ml/index">Snowpark ML Documentation</a> 4. <a href="https://github.com/Snowflake-Labs/snowpark-python-examples">Feature Store Examples</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Jeremy-Demlow\.github\.io\/sf-feature-store");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Jeremy-Demlow/sf-feature-store/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>