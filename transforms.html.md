# Feature Transforms


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L27"
target="_blank" style="float:right; font-size:smaller">source</a>

### TransformConfig

>  TransformConfig (name:str, description:Optional[str]=None,
>                       validate_output:bool=True, null_threshold:typing.Annotat
>                       ed[float,Ge(ge=0),Le(le=1)]=0.1,
>                       cardinality_threshold:Optional[int]=None,
>                       expected_types:Optional[List[str]]=None)

*Configuration for data transformations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L52"
target="_blank" style="float:right; font-size:smaller">source</a>

### Transform

>  Transform (*args, **kwargs)

*Protocol for feature transformations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### ValidationMixin

>  ValidationMixin ()

*Mixin class providing validation methods for transforms*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L113"
target="_blank" style="float:right; font-size:smaller">source</a>

### CustomTransform

>  CustomTransform (transform_func:Callable[[snowflake.snowpark.dataframe.Da
>                       taFrame],snowflake.snowpark.dataframe.DataFrame],
>                       config:__main__.TransformConfig)

*Wrapper for custom transformations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L132"
target="_blank" style="float:right; font-size:smaller">source</a>

### WindowSpec

>  WindowSpec (partition_by:Union[str,List[str],NoneType]=None,
>                  order_by:Union[str,List[str],NoneType]=None,
>                  window_size:Optional[int]=None)

*Configuration for window-based transformations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L158"
target="_blank" style="float:right; font-size:smaller">source</a>

### WindowTransform

>  WindowTransform (agg_cols:Dict[str,List[str]],
>                       window_spec:__main__.WindowSpec,
>                       config:Optional[__main__.TransformConfig]=None)

*Window-based aggregation transform*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L204"
target="_blank" style="float:right; font-size:smaller">source</a>

### window_agg

>  window_agg (agg_cols:Dict[str,List[str]],
>                  window_spec:__main__.WindowSpec,
>                  config:Optional[__main__.TransformConfig]=None)

\*Create window-based aggregation transform

Args: agg_cols: Dictionary mapping columns to aggregation functions
window_spec: Window specification for the aggregation config: Optional
transform configuration

Returns: Transform function

Example: \>\>\> config = TransformConfig( … name=“customer_metrics”, …
null_threshold=0.05, … expected_type=“DOUBLE” … ) \>\>\> spec =
WindowSpec(partition_by=‘customer_id’, order_by=‘date’) \>\>\> transform
= window_agg({‘amount’: \[‘SUM’, ‘AVG’\]}, spec, config)\*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L231"
target="_blank" style="float:right; font-size:smaller">source</a>

### FillNATransform

>  FillNATransform (cols:Union[str,List[str]],
>                       fill_value:Union[int,float,str]=0,
>                       config:Optional[__main__.TransformConfig]=None)

*Mixin class providing validation methods for transforms*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L278"
target="_blank" style="float:right; font-size:smaller">source</a>

### fill_na

>  fill_na (cols:Union[str,List[str]], fill_value:Union[int,float,str]=0,
>               config:Optional[__main__.TransformConfig]=None)

\*Create transform to fill NA values

Args: cols: Column(s) to fill NA values in fill_value: Value to use for
filling NAs config: Optional transform configuration

Returns: Transform function

Example: \>\>\> config = TransformConfig( … name=“fill_scores”, …
null_threshold=1.0 … ) \>\>\> transform = fill_na(\[‘score’\],
fill_value=0, config=config)\*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L304"
target="_blank" style="float:right; font-size:smaller">source</a>

### DateDiffTransform

>  DateDiffTransform (col:str, new_col:str,
>                         reference_date:Optional[str]=None,
>                         date_part:str='day',
>                         config:Optional[__main__.TransformConfig]=None)

*Calculate date difference between column and reference*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L360"
target="_blank" style="float:right; font-size:smaller">source</a>

### date_diff

>  date_diff (col:str, new_col:str, reference_date:Optional[str]=None,
>                 date_part:str='day',
>                 config:Optional[__main__.TransformConfig]=None)

\*Create date difference transform

Args: col: Date column to calculate difference from new_col: Name for
the new difference column reference_date: Reference date (default:
current_date) date_part: Part to calculate difference in (‘day’,
‘month’, etc.) config: Optional transform configuration

Returns: Transform function

Example: \>\>\> config = TransformConfig( … name=“membership_length”, …
null_threshold=0.0 \# No nulls allowed … ) \>\>\> transform =
date_diff(‘join_date’, ‘days_member’, config=config)\*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L389"
target="_blank" style="float:right; font-size:smaller">source</a>

### MovingAggTransform

>  MovingAggTransform (cols:Union[str,List[str]], window_sizes:List[int],
>                          agg_funcs:List[str]=['SUM', 'AVG'],
>                          partition_by:Optional[List[str]]=None,
>                          order_by:Optional[List[str]]=None,
>                          config:Optional[__main__.TransformConfig]=None)

*Calculate moving window aggregations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L451"
target="_blank" style="float:right; font-size:smaller">source</a>

### moving_agg

>  moving_agg (cols:Union[str,List[str]], window_sizes:List[int],
>                  agg_funcs:List[str]=['SUM', 'AVG'],
>                  partition_by:Optional[List[str]]=None,
>                  order_by:Optional[List[str]]=None,
>                  config:Optional[__main__.TransformConfig]=None)

\*Create moving aggregation transform

Args: cols: Columns to aggregate window_sizes: List of window sizes
agg_funcs: List of aggregation functions partition_by: Columns to
partition by order_by: Columns to order by config: Optional transform
configuration

Returns: Transform function

Example: \>\>\> config = TransformConfig( … name=“rolling_metrics”, …
expected_type=“DOUBLE” … ) \>\>\> transform = moving_agg( … ‘amount’, …
\[7, 30\], … \[‘SUM’\], … \[‘customer_id’\], … \[‘date’\], … config …
)\*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L492"
target="_blank" style="float:right; font-size:smaller">source</a>

### CumulativeAggTransform

>  CumulativeAggTransform (cols:Union[str,List[str]],
>                              agg_funcs:List[str]=['SUM'],
>                              partition_by:Optional[List[str]]=None,
>                              order_by:Optional[List[str]]=None,
>                              config:Optional[__main__.TransformConfig]=None)

*Calculate cumulative aggregations*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L547"
target="_blank" style="float:right; font-size:smaller">source</a>

### cumulative_agg

>  cumulative_agg (cols:Union[str,List[str]], agg_funcs:List[str]=['SUM'],
>                      partition_by:Optional[List[str]]=None,
>                      order_by:Optional[List[str]]=None,
>                      config:Optional[__main__.TransformConfig]=None)

\*Create cumulative aggregation transform

Args: cols: Columns to aggregate agg_funcs: List of aggregation
functions partition_by: Columns to partition by order_by: Columns to
order by config: Optional transform configuration

Returns: Transform function

Example: \>\>\> config = TransformConfig( … name=“running_totals”, …
expected_type=“DOUBLE” … ) \>\>\> transform = cumulative_agg( …
‘amount’, … \[‘SUM’\], … \[‘customer_id’\], … \[‘date’\], … config … )\*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/transforms.py#L584"
target="_blank" style="float:right; font-size:smaller">source</a>

### apply_transforms

>  apply_transforms (df:snowflake.snowpark.dataframe.DataFrame,
>                        transforms:List[__main__.Transform])

\*Apply a list of transformations to a DataFrame

Args: df: Input DataFrame transforms: List of transform functions to
apply

Returns: Transformed DataFrame

Example: \>\>\> transforms = \[ … fill_na(\[‘score’\],
config=TransformConfig(name=‘fill_scores’)), … date_diff(‘date’,
‘days_ago’, config=TransformConfig(name=‘time_features’)) … \] \>\>\> df
= apply_transforms(df, transforms)\*

``` python
# Example usage
from snowflake_feature_store.connection import get_connection, ConnectionConfig
from snowflake_feature_store.transforms import *

# Get connection automatically
conn = get_connection()
session = conn.session

# Create example DataFrame - Note the UPPERCASE column names for Snowflake
df = session.create_dataframe([
    ['C1', '2024-01-01', 100, None],
    ['C1', '2024-01-02', 200, 3.5],
    ['C2', '2024-01-01', 150, None]
], ['CUSTOMER_ID', 'DATE', 'AMOUNT', 'SCORE'])

# Configuration with appropriate type validation
agg_config = TransformConfig(
    name="customer_metrics",
    null_threshold=0.05,
    expected_types=['LONG', 'DOUBLE']  # Accept either type for numeric aggregations
)

date_config = TransformConfig(
    name="date_features",
    null_threshold=0.0,
    expected_types=['INT', 'LONG']  # Date diffs can be either type
)

# Create transforms
transforms = [
    # Fill NA values in score column
    fill_na(['SCORE'], fill_value=0),
    
    # Calculate moving aggregations on amount
    moving_agg(
        cols='AMOUNT',
        window_sizes=[2],
        agg_funcs=['SUM', 'AVG'],  # Now we can use both
        partition_by=['CUSTOMER_ID'],
        order_by=['DATE'],
        config=agg_config
    ),
    
    # Calculate date differences
    date_diff(
        col='DATE',
        new_col='DAYS_AGO',
        reference_date='2024-01-03',
        config=date_config
    )
]

# Apply transforms
result_df = apply_transforms(df, transforms)

# Show results
print("\nTransformed DataFrame:")
result_df.show()

# Show schema
print("\nResult Schema:")
for field in result_df.schema.fields:
    print(f"{field.name}: {field.datatype}")
```

    2025-02-26 19:34:47,083 - snowflake_feature_store - INFO - No active session found, creating new connection from environment
    2025-02-26 19:34:47,762 - snowflake_feature_store - INFO - Initialized connection to "CONTAINER_DEMO_DB"."PUBLIC"
    2025-02-26 19:34:47,763 - snowflake_feature_store - INFO - Using role: "ACCOUNTADMIN", warehouse: "CONTAINER_DEMO_WH", database: "CONTAINER_DEMO_DB", schema: "PUBLIC"

    Transformed DataFrame:
    --------------------------------------------------------------------------------------------------
    |"CUSTOMER_ID"  |"DATE"      |"AMOUNT"  |"SCORE"  |"SUM_AMOUNT_2"  |"AVG_AMOUNT_2"  |"DAYS_AGO"  |
    --------------------------------------------------------------------------------------------------
    |C2             |2024-01-01  |150       |0.0      |150.0           |150.0           |2           |
    |C1             |2024-01-01  |100       |0.0      |100.0           |100.0           |2           |
    |C1             |2024-01-02  |200       |3.5      |300.0           |150.0           |1           |
    --------------------------------------------------------------------------------------------------


    Result Schema:
    CUSTOMER_ID: StringType()
    DATE: StringType()
    AMOUNT: LongType()
    SCORE: DoubleType()
    SUM_AMOUNT_2: DoubleType()
    AVG_AMOUNT_2: DoubleType()
    DAYS_AGO: LongType()
