# Feature Views


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/feature_view.py#L32"
target="_blank" style="float:right; font-size:smaller">source</a>

### FeatureStats

>  FeatureStats (timestamp:datetime.datetime, row_count:int, null_count:int,
>                    null_ratio:float, unique_count:Optional[int]=None,
>                    min_value:Optional[float]=None,
>                    max_value:Optional[float]=None,
>                    mean_value:Optional[float]=None,
>                    std_value:Optional[float]=None)

*Statistics for feature monitoring*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/feature_view.py#L71"
target="_blank" style="float:right; font-size:smaller">source</a>

### FeatureMonitor

>  FeatureMonitor
>                      (feature_config:snowflake_feature_store.config.FeatureCon
>                      fig, collect_detailed_stats:bool=True)

*Monitor feature statistics and detect drift*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/feature_view.py#L219"
target="_blank" style="float:right; font-size:smaller">source</a>

### FeatureViewBuilder

>  FeatureViewBuilder
>                          (config:snowflake_feature_store.config.FeatureViewCon
>                          fig,
>                          feature_df:snowflake.snowpark.dataframe.DataFrame, en
>                          tities:Union[snowflake.ml.feature_store.entity.Entity
>                          ,List[snowflake.ml.feature_store.entity.Entity]],
>                          collect_stats:bool=True)

*Builder for creating feature views with monitoring*

------------------------------------------------------------------------

<a
href="https://github.com/Jeremy-Demlow/sf-feature-store/blob/main/snowflake_feature_store/feature_view.py#L316"
target="_blank" style="float:right; font-size:smaller">source</a>

### create_feature_view

>  create_feature_view
>                           (config:snowflake_feature_store.config.FeatureViewCo
>                           nfig,
>                           feature_df:snowflake.snowpark.dataframe.DataFrame, e
>                           ntities:Union[snowflake.ml.feature_store.entity.Enti
>                           ty,List[snowflake.ml.feature_store.entity.Entity]],
>                           collect_stats:bool=True)

\*Create a feature view with validation and monitoring

Args: config: Feature view configuration feature_df: DataFrame
containing feature transformations entities: Entity or list of entities
collect_stats: Whether to collect detailed statistics

Returns: Configured FeatureView object

Example: \>\>\> config = FeatureViewConfig( … name=“customer_behavior”,
… domain=“RETAIL”, … features={ … “session_length”: FeatureConfig( …
name=“session_length”, … description=“Session length in minutes”, …
validation=FeatureValidationConfig( … null_threshold=0.1, …
range_check=True, … min_value=0 … ) … ) … } … ) \>\>\> entity =
Entity(“CUSTOMER”, \[“customer_id”\]) \>\>\> feature_view =
create_feature_view(config, df, entity)\*

``` python
from snowflake_feature_store.feature_view import *
from snowflake_feature_store.config import *
from snowflake_feature_store.connection import get_connection
from snowflake_feature_store.transforms import *

from snowflake.ml.feature_store import Entity
import snowflake.snowpark.functions as F


# Get connection
conn = get_connection()
session = conn.session

# Create sample data
data = [
    ['C1', '2024-01-01', 30, 2],
    ['C1', '2024-01-02', 45, 3],
    ['C2', '2024-01-01', 15, 1],
    ['C2', '2024-01-02', 60, 4]
]

# Create feature DataFrame
feature_df = session.create_dataframe(
    data,
    schema=['CUSTOMER_ID', 'DATE', 'AVG_SESSION_LENGTH', 'TOTAL_PURCHASES']
)
# Create customer entity
customer_entity = Entity(
    name="CUSTOMER",
    join_keys=["CUSTOMER_ID"],
    desc="Customer entity for retail domain"
)

# Create feature configurations
feature_configs = {
    "AVG_SESSION_LENGTH": FeatureConfig(
        name="AVG_SESSION_LENGTH",
        description="Average session length in minutes",
        validation=FeatureValidationConfig(
            null_threshold=0.1,
            range_check=True,
            min_value=0
        )
    ),
    "TOTAL_PURCHASES": FeatureConfig(
        name="TOTAL_PURCHASES",
        description="Total number of purchases",
        validation=FeatureValidationConfig(
            null_threshold=0.05,
            range_check=True,
            min_value=0
        )
    )
}

# Create feature view config
config = FeatureViewConfig(
    name="customer_behavior",
    domain="RETAIL",
    entity="CUSTOMER",
    feature_type="BEHAVIOR",
    refresh=RefreshConfig(frequency="1 day"),
    features=feature_configs,
    description="Customer behavior features"
)

# Create feature view with monitoring
feature_view = create_feature_view(
    config, 
    feature_df, 
    customer_entity,
    collect_stats=True
)

# Show the feature view data
print("\nFeature View Data:")
feature_view.feature_df.show()

# Access feature monitors
builder = FeatureViewBuilder(config, feature_df, customer_entity)
for feature_name, monitor in builder.monitors.items():
    stats = monitor.compute_stats(feature_df, feature_name)
    print(f"\nStats for {feature_name}:")
    print(json.dumps(stats.model_dump(), indent=2))

# Create transform configurations
transform_config = TransformConfig(
    name="session_metrics",
    null_threshold=0.05,
    expected_types=['DECIMAL', 'DOUBLE', 'NUMBER']  # Accept any numeric type
)

# Apply transforms to create features
transforms = [
    moving_agg(
        cols='AVG_SESSION_LENGTH',
        window_sizes=[7],  # 7-day window
        agg_funcs=['AVG', 'MAX'],
        partition_by=['CUSTOMER_ID'],
        order_by=['DATE'],
        config=transform_config
    )
]

# Apply transforms to create feature DataFrame
feature_df = apply_transforms(feature_df, transforms)
```

    2025-02-16 20:56:04,651 - snowflake_feature_store - INFO - No active session found, creating new connection from environment

    /Users/jdemlow/miniconda3/envs/feature-store/lib/python3.11/site-packages/pydantic/_internal/_fields.py:192: UserWarning: Field name "schema" in "ConnectionConfig" shadows an attribute in parent "BaseModel"
      warnings.warn(

    2025-02-16 20:56:05,094 - snowflake_feature_store - INFO - Initialized connection to "CONTAINER_DEMO_DB"."PUBLIC"
    -------------------------------------------------------------------------
    |"CUSTOMER_ID"  |"DATE"      |"AVG_SESSION_LENGTH"  |"TOTAL_PURCHASES"  |
    -------------------------------------------------------------------------
    |C1             |2024-01-01  |30                    |2                  |
    |C1             |2024-01-02  |45                    |3                  |
    |C2             |2024-01-01  |15                    |1                  |
    -------------------------------------------------------------------------

    2025-02-16 20:56:06,339 - snowflake_feature_store - INFO - Validated feature AVG_SESSION_LENGTH (stats: {'timestamp': '2025-02-17T04:56:05.679493', 'row_count': 4, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 4, 'min_value': 15.0, 'max_value': 60.0, 'mean_value': 37.5, 'std_value': 19.364916731037084})
    2025-02-16 20:56:07,502 - snowflake_feature_store - INFO - Validated feature TOTAL_PURCHASES (stats: {'timestamp': '2025-02-17T04:56:06.580706', 'row_count': 4, 'null_count': 0, 'null_ratio': 0.0, 'unique_count': 4, 'min_value': 1.0, 'max_value': 4.0, 'mean_value': 2.5, 'std_value': 1.290994577835244})

    Feature View Data:
    -------------------------------------------------------------------------
    |"CUSTOMER_ID"  |"DATE"      |"AVG_SESSION_LENGTH"  |"TOTAL_PURCHASES"  |
    -------------------------------------------------------------------------
    |C1             |2024-01-01  |30                    |2                  |
    |C1             |2024-01-02  |45                    |3                  |
    |C2             |2024-01-01  |15                    |1                  |
    |C2             |2024-01-02  |60                    |4                  |
    -------------------------------------------------------------------------


    Stats for AVG_SESSION_LENGTH:
    {
      "timestamp": "2025-02-17T04:56:07.827584",
      "row_count": 4,
      "null_count": 0,
      "null_ratio": 0.0,
      "unique_count": 4,
      "min_value": 15.0,
      "max_value": 60.0,
      "mean_value": 37.5,
      "std_value": 19.364916731037084
    }

    Stats for TOTAL_PURCHASES:
    {
      "timestamp": "2025-02-17T04:56:08.595868",
      "row_count": 4,
      "null_count": 0,
      "null_ratio": 0.0,
      "unique_count": 4,
      "min_value": 1.0,
      "max_value": 4.0,
      "mean_value": 2.5,
      "std_value": 1.290994577835244
    }
